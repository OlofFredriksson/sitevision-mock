# sitevision-mock

> Jest mock for Sitevision Webapps / Restapps (Server side Javascript). Works with both Webapps 1 and 2.

[![Build](https://github.com/OlofFredriksson/sitevision-mock/workflows/Build/badge.svg)](https://github.com/OlofFredriksson/sitevision-mock/actions)
[![npm](https://img.shields.io/npm/v/sitevision-mock)](https://www.npmjs.com/package/sitevision-mock)

## Prerequisites

**Only applies if you are building the applications in the old / legacy way**

-   Your Module Server Javascript code must be written in ES6-format in order to use this mock, see more here how to get started:
    https://github.com/OlofFredriksson/babel-plugin-transform-sitevision-apps

More information regarding the "bundled app" concept, please read on the following link:
https://developer.sitevision.se/archives/developer-news/developer-news/2021-06-10-bundled-apps

## Getting started

`npm install --save-dev sitevision-mock`

### Load all (recommended)

In your `jest.config.js`, add following:

```javascript
{
  "moduleNameMapper": {
      ...require("sitevision-mock")
  }
}
```

## Examples

See the tests in **integration/** if you need some inspiration how to write test cases with this mock.

## Transformers

The Sitevision API sometimes returns Java Objects, List & Calendar for example. This repo also contains transformers which could help you adding mock data.

Helpfull to use if you for example need to mock PropertyUtil values.

```Javascript
// Your Test file
import List from "sitevision-mock/dist/transformers/List";
...
const node = {
  yourProperty: new List([1, 2, 3]),
};
```

## Limits

-   Dont use `jest.mock("Sitevision Class")` since the objects is already jest mocks.

## Typescript

sitevision-mock supports webapps written in Typescript. However, due to limitations with the Sitevision Typings file, you cant setMockData directly on the imported members. See workaround:

**Working**

```javascript
import { setMockData } from "sitevision-mock/dist/setMockData";
setMockData("PortletContextUtil", {
    getCurrentPage: { key2: "/URI" },
});
```

**Not Working**

```javascript
import portletContextUtil from "PortletContextUtil";
portletContextUtil.__setMockData({
    getCurrentPage: { key1: "/URI" },
});
```

If you use Javascript both ways work.

## Why using this?

If you write unit tests with Jest, you should be able to focus on writing tests on the functions and logic in your code, not spend time on writing mock functions that you should just ignore.

Imported classes will get wrapped in a jest object, so you can mock the return value or check if functions have been called.

Without this plugin, you could use [virtual mocks with jest](https://jestjs.io/docs/en/jest-object) to define the files.

## References Sitevision API

-   https://developer.sitevision.se/webdav/files/apidocs/overview-summary.html
-   https://developer.sitevision.se/docs/webapps

## Notice

This project is made during my spare time and since I dont have access to any Sitevision server its quite hard at the moment to show a good template project where this mock, and the babel-transform-plugin is used.

In a perfect world, maybe this mock is something that in the future should be generated by Sitevision themself? Much easier than doing reverse engineering. :-) (But less fun?)
